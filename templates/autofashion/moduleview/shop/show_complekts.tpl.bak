{assign var=shop_config value=ConfigLoader::byModule('shop')}
{assign var=check_quantity value=$shop_config.check_quantity}

{*Подгружаем цвета*}
{modulegetvars name="\Colors\Controller\BlockValues" var="colors"}

{$product->fillOffersStockStars()}

<div class="authorization formStyle reserveForm complectsPopup">
	<div class="multiComplectations{if !$product->isAvailable()} notAvaliable{/if}{if $product->canBeReserved()} canBeReserved{/if}{if $product.reservation == 'forced'} forcedReserve{/if}" data-id="{$product.id}">
		<div class="row">
			<div class="col-md-24">
				<h1>{$product.title}</h1>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12 leftColumn">
				<div class="image">
					{$main_image=$product->getMainImage()}
					<img src="{$main_image->getUrl(275, 380)}" class="photo" alt="{$main_image.title|default:"{$product.title}"}"/>
				</div>
			</div>
			<div class="col-md-12 rightColumn">
				<div class="fcost">
					{*assign var=last_price value=$product->getCost('Зачеркнутая цена')}
					{if $last_price>0}<div class="lastPrice">{$last_price}</div>{/if*}
					<span class="myCost">{$product->getCost()} {$product->getCurrency()}</span>
				</div>
				{if $product.barcode}
					<p class="barcode"><span class="cap">Артикул:</span> <strong class="offerBarcode">{$product.barcode}</strong></p>
				{/if}


				{*<div class="multiOffers">
						<div class="title">Размер</div>
						<div class="multiofferBlock multiofferBlock2">
							<div class="moItem active"><div class="moItemInner">48</div></div>
							<div class="moItem"><div class="moItemInner">50</div></div>
							<div class="moItem"><div class="moItemInner">52</div></div>
							<div class="moItem"><div class="moItemInner">54</div></div>
						</div>
						<div class="clearfix"></div>
						<div class="title">Цвет</div>
						<div class="multiofferBlock multiofferBlock1">
							<div class="moItem active"><div class="moItemInner" style="background-color:#fff;background-image: linear-gradient( -45deg, #ff9100 0%, #ff9100 50%, #c78800 50%, #c78800 50%);" title="Коричнево-оранжевый">Коричнево-оранжевый</div></div>
							<div class="moItem"><div class="moItemInner" style="background-color:#fff;background-image: linear-gradient( -45deg, #ff0000 0%, #ff0000 50%, #ff0000 50%, #ff0000 50%);" title="Красный">Красный</div></div>
							<div class="moItem"><div class="moItemInner" style="background-color:#fff;background-image: linear-gradient( -45deg, #c4c4c4 0%, #c4c4c4 50%, #c4c4c4 50%, #c4c4c4 50%);" title="Серый">Серый</div></div>
							<div class="moItem"><div class="moItemInner" style="background-color:#fff;background-image: linear-gradient( -45deg,  0%,  50%,  50%,  50%);" title="Тёмно-бордовый">Тёмно-бордовый</div></div>
						</div>
						<div class="clearfix"></div>
						<div class="title">Мех</div>
						<div class="multiofferBlock multiofferBlock3">
							<div class="moItem active"><div class="moItemInner">Енот Grey</div></div>
							<div class="moItem"><div class="moItemInner">Енот натуральный</div></div>
						</div>
						<div class="clearfix"></div>
						<div class="quantity">Кол-во на складе: <span class="text-success">много</span></div>
						<div class="clearfix"></div>
						<div class="toCartWrap">
			                <a data-href="#" class="button showMultiOffers inDialog noShowCart compPopupButt">
								<img src="/templates/autofashion/resource/img/cart.png" alt="Add to Cart" width="20px" height="20px">
			                    <div class="toCartText">
			                        В корзину
			                    </div>
			                </a>
			            </div>
			            <div class="clearfix"></div>
					</div>*}





				<div class="multiOffers">
					{foreach $product.multioffers.levels as $level}
						{if !empty($level.values) && $level.title != 'Цвет'}
							<div class="multiofferTitle">{if $level.title}{$level.title}{else}{$level.prop_title}{/if}</div>
							{if !$level.is_photo && !isset($level.values_photos)} {* Если отображать не как фото (выпадающим списком)*}
								<select name="multioffers[{$level.prop_id}]" data-prop-title="{if $level.title}{$level.title}{else}{$level.prop_title}{/if}">
									{foreach $level.values as $value}
										<option value="{$value.val_str}">{$value.val_str}</option>
									{/foreach}
								</select>
								<div class="multiofferBlock multiofferBlock{$level.prop_id}">
									{foreach $level.values as $value key=i}
										<div class="moItem{if $i == 1} active{/if}"><div class="moItemInner">{$value.val_str}</div></div>
									{/foreach}
								</div>
								<div class="clearfix"></div>
							{else}
								<div class="multiOfferValues">
									<input type="hidden" name="multioffers[{$level.prop_id}]" data-prop-title="{if $level.title}{$level.title}{else}{$level.prop_title}{/if}"/>
									{foreach $level.values as $value}
										{if isset($level.values_photos[$value.val_str])}
											<a class="multiOfferValueBlock {if $value@first}sel{/if}" data-value="{$value.val_str}" title="{$value.val_str}"><img src="{$level.values_photos[$value.val_str]->getUrl(40,40,'axy')}"/></a>
										{else}
											<a class="multiOfferValueBlock likeString {if $value@first}sel{/if}" data-value="{$value.val_str}" title="{$value.val_str}">{$value.val_str}</a>
										{/if}
									{/foreach}
								</div>
							{/if}
						{else if !empty($level.values) && $level.title == 'Цвет'}
							<div class="multiofferTitle">{if $level.title}{$level.title}{else}{$level.prop_title}{/if}</div>
							<select name="multioffers[{$level.prop_id}]" data-prop-title="{if $level.title}{$level.title}{else}{$level.prop_title}{/if}">
								{foreach $level.values as $value}
									<option value="{$value.val_str}">{$value.val_str}</option>
								{/foreach}
							</select>
							<div class="multiofferBlock multiofferBlock{$level.prop_id}">
								{foreach $level.values as $value key=i}
									<div class="moItem{if $i == 1} active{/if}"><div class="moItemInner" style="background-color:#fff;background-image: linear-gradient( -45deg, {$colors.colors[$value.val_str].color2} 0%, {$colors.colors[$value.val_str].color2} 50%, {$colors.colors[$value.val_str].color1} 50%, {$colors.colors[$value.val_str].color1} 50%);" title="{$value.val_str}">{$value.val_str}</div></div>
								{/foreach}
							</div>
							<div class="clearfix"></div>
						{/if}
					{/foreach}
				</div>
			</div>
			<div class="leftColumn hidden">
				{if $product->isMultiOffersUse()}
					{* Многомерные комплектации *}
					<!-- <span class="pname">{$product.offer_caption|default:'Комплектация'}</span> -->
					{* Подгрузим у многомерных комплектаций фото к их вариантам *}
					{$product->fillMultiOffersPhotos()}
					{* Переберём доступные многомерные комплектации *}
					{if $product->isOffersUse()}
						{foreach from=$product.offers.items key=key item=offer name=offers}
							<input value="{$key}" type="hidden" name="hidden_offers" class="hidden_offers" {if $smarty.foreach.offers.first}checked{/if} id="offer_{$key}" data-info='{$offer->getPropertiesJson()}' {if $check_quantity}data-num="{$offer.num}"{/if} data-change-cost='{ ".offerBarcode": "{$offer.barcode|default:$product.barcode}", ".myCost": "{$product->getCost(null, $key)}", ".lastPrice": "{$product->getCost('Зачеркнутая цена', $key)}"}' data-images='{$offer->getPhotosJson()}' data-sticks='{$offer->getStickJson()}'/>
						{/foreach}

						<input type="hidden" name="offer" value="0"/>
					{/if}
				{elseif $product->isOffersUse()}
					{* Простые комплектации *}
					<div class="packages">
						<div class="package">
							<span class="pname">{$product.offer_caption|default:'Комплектация'}</span>
							<div class="values">
								{if count($product.offers.items)>5}
									<select name="offer">
										{foreach from=$product.offers.items key=key item=offer name=offers}
										<option value="{$key}" {if $smarty.foreach.offers.first}checked{/if} data-num="{$offer.num}" data-change-cost='{ ".myCost": "{$product->getCost(null, $key)}", ".lastPrice": "{$product->getCost('Зачеркнутая цена', $key)}"}' data-images='{$offer->getPhotosJson()}' data-sticks='{$offer->getStickJson()}'>{$offer.title}</option>
										{/foreach}
									</select>
								{else}
									{foreach from=$product.offers.items key=key item=offer name=offers}
										<input value="{$key}" type="radio" name="offer" {if $smarty.foreach.offers.first}checked{/if} id="offer_{$key}" data-num="{$offer.num}" data-change-cost='{ ".myCost": "{$product->getCost(null, $key)}", ".lastPrice": "{$product->getCost('Зачеркнутая цена', $key)}"}' data-images='{$offer->getPhotosJson()}' data-sticks='{$offer->getStickJson()}'>
										<label for="offer_{$key}">{$offer.title}</label><br>
									{/foreach}
								{/if}
							</div>
						</div>
					</div>
				{/if}

				<div class="buttons">
					<a data-href="{$router->getUrl('shop-front-reservation', ["product_id" => $product.id])}" class="button reserve inDialog">Заказать</a>
					<span class="unobtainable">Нет в наличии</span>
					<a data-href="{$router->getUrl('shop-front-cartpage', ["add" => $product.id])}" class="button addToCart noShowCart">В корзину</a>
				</div>
			</div>
		</div>
		<div class="row">
			<div class="col-md-24">
				<div class="information">
				{if $product.description}
					<p class="descr">{$product.description|strip_tags|teaser:510}</p>
				{/if}
				</div>
				<div class="clearfix"></div>
			</div>
		</div>
	</div>
	</div>
</div>

{literal}
	<script type="text/javascript">
		$(function() {
			$('.moItem').on('click', function() {
				var value = $(this).text();
				$(this).addClass('active').siblings('.moItem').removeClass('active');
				$(this).parent().closest('[name^="multioffers["]').val(value).trigger('change');
			});
			$('[name="offer"]').changeOffer();


			$('.multiComplectations .addToCart').on('click',function(){
				$.colorbox.close();
			});
			// Меняем селекты по нажатию на блок
		});

	</script>
{/literal}
